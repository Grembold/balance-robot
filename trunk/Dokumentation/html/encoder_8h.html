<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>nBot: encoder.h-Dateireferenz</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Erzeugt von Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Hauptseite</span></a></li>
    <li><a href="annotated.html"><span>Datenstrukturen</span></a></li>
    <li class="current"><a href="files.html"><span>Dateien</span></a></li>
    <li><a href="dirs.html"><span>Verzeichnisse</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>Auflistung&nbsp;der&nbsp;Dateien</span></a></li>
    <li><a href="globals.html"><span>Datei-Elemente</span></a></li>
  </ul>
</div>
<div class="nav">
<a class="el" href="dir_6bb2651bc0a152aa2f3f5a312f6d27ea.html">nbot_lib</a></div>
<h1>encoder.h-Dateireferenz</h1>Definitionen und Funktionen für die Encoder Auswertung. <a href="#_details">Mehr ...</a>
<p>

<p>
Dieser Graph zeigt, welche Datei direkt oder indirekt diese Datei enthÃ¤lt:<p><center><img src="encoder_8h__dep__incl.png" border="0" usemap="#encoder.hdep_map" alt=""></center>
<map name="encoder.hdep_map">
<area shape="rect" href="encoder_8c.html" title="Definitionen und Funktionen für die Encoder Auswertung." alt="" coords="137,5,217,32"></map>

<p>
<a href="encoder_8h-source.html">gehe zum Quellcode dieser Datei</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Makrodefinitionen</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="437ef08681e7210d6678427030446a54"></a><!-- doxytag: member="encoder.h::LEFT" ref="437ef08681e7210d6678427030446a54" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="encoder_8h.html#437ef08681e7210d6678427030446a54">LEFT</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="80fb826a684cf3f0d306b22aa100ddac"></a><!-- doxytag: member="encoder.h::RIGHT" ref="80fb826a684cf3f0d306b22aa100ddac" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="encoder_8h.html#80fb826a684cf3f0d306b22aa100ddac">RIGHT</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="encoder_8h.html#641ad630e162ad78992d76dfae66a485">UMRECHNUG_ECNODER_MM</a>&nbsp;&nbsp;&nbsp;4898L</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Umrechnungsfaktor von Flanken -&gt; mm.  <a href="#641ad630e162ad78992d76dfae66a485"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Funktionen</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="encoder_8h.html#b885d9bad57d89e5f53eb590dc3d6011">encoder_init</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialisiert die Encoderauswertung.  <a href="#b885d9bad57d89e5f53eb590dc3d6011"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int16_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="encoder_8h.html#1ef2ce91101e182f4ce4142b56b59cb9">encoderGet</a> (uint8_t motor)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Liefert den Zählerstand seit dem letzten Auslesen des Encoders.  <a href="#1ef2ce91101e182f4ce4142b56b59cb9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="encoder_8h.html#e084907e786b88426e7ef87b1a935bda">encoderToMM</a> (int32_t <a class="el" href="globals_8c.html#8d98bfd378d27bc50413c83662cdc0b9">encoder</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Umrechner von EncoderFlanken nach mm.  <a href="#e084907e786b88426e7ef87b1a935bda"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>AusfÃ¼hrliche Beschreibung</h2>
Definitionen und Funktionen für die Encoder Auswertung. 
<p>
<dl class="rcs" compact><dt><b>Revision</b></dt><dd>0.1 </dd></dl>
<dl class="rcs" compact><dt><b>Date</b></dt><dd>05.03.2007 </dd></dl>
<dl class="rcs" compact><dt><b>Author</b></dt><dd>Olaf Petersen </dd></dl>
<p>
<dl class="user" compact><dt><b>Description: new functions has been added:</b></dt><dd></dd></dl>
void Encoder_init() int16_t EncoderGet(uint8_t motor) int32_t EncoderToMM(int32_t encoder)<p>
<dl class="version" compact><dt><b>Version:</b></dt><dd>V1.0 - 18.08.2007 - Olaf Petersen<br>
 created </dd></dl>

<p>
Definiert in Datei <a class="el" href="encoder_8h-source.html">encoder.h</a>.<hr><h2>Makro-Dokumentation</h2>
<a class="anchor" name="641ad630e162ad78992d76dfae66a485"></a><!-- doxytag: member="encoder.h::UMRECHNUG_ECNODER_MM" ref="641ad630e162ad78992d76dfae66a485" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define UMRECHNUG_ECNODER_MM&nbsp;&nbsp;&nbsp;4898L          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Umrechnungsfaktor von Flanken -&gt; mm. 
<p>
<dl class="user" compact><dt><b>Funktionsweise:</b></dt><dd>Mit diesem Faktor wird aus der Flangenzahl des Encoders die zurückgelegte Strecke der Reifen umgerechnet.<br>
 Die Flankenzahl des encoders muss zunächst mit 10000 Multipliziert werden und dann mit diesem Wert dividiert.<br>
</dd></dl>
<dl class="user" compact><dt><b>Beispiel:</b></dt><dd><div class="fragment"><pre class="fragment">   distance = enc_count * 10000;
   distance /= <a class="code" href="encoder_8h.html#641ad630e162ad78992d76dfae66a485" title="Umrechnungsfaktor von Flanken -&gt; mm.">UMRECHNUG_ECNODER_MM</a>;
</pre></div> </dd></dl>

<p>
Definiert in Zeile <a class="el" href="encoder_8h-source.html#l00045">45</a> der Datei <a class="el" href="encoder_8h-source.html">encoder.h</a>.
</div>
</div><p>
<hr><h2>Dokumentation der Funktionen</h2>
<a class="anchor" name="b885d9bad57d89e5f53eb590dc3d6011"></a><!-- doxytag: member="encoder.h::encoder_init" ref="b885d9bad57d89e5f53eb590dc3d6011" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void encoder_init           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initialisiert die Encoderauswertung. 
<p>
Hier wird die Datenrichtung der Angeschlossenen Pins und die einstellungen für den Timer0 vorgenommen. 
<p>
Definiert in Zeile <a class="el" href="encoder_8c-source.html#l00051">51</a> der Datei <a class="el" href="encoder_8c-source.html">encoder.c</a>.<div class="fragment"><pre class="fragment"><a name="l00052"></a>00052 {
<a name="l00053"></a>00053         DDRC &amp;= ~((1&lt;&lt;PC0) | (1&lt;&lt;PC1) | (1&lt;&lt;PC2) | (1&lt;&lt;PC3));           <span class="comment">// Phasen des rechten Motors als Input</span>
<a name="l00054"></a>00054         PORTC |= ((1&lt;&lt;PC0) | (1&lt;&lt;PC1) | (1&lt;&lt;PC2) | (1&lt;&lt;PC3));           <span class="comment">// Interne Pull-Up für beide einschalten</span>
<a name="l00055"></a>00055         <a class="code" href="encoder_8c.html#1ef2ce91101e182f4ce4142b56b59cb9" title="Liefert den Zählerstand seit dem letzten Auslesen des Encoders.">encoderGet</a>(<a class="code" href="encoder_8h.html#437ef08681e7210d6678427030446a54">LEFT</a>);       
<a name="l00056"></a>00056         <a class="code" href="encoder_8c.html#1ef2ce91101e182f4ce4142b56b59cb9" title="Liefert den Zählerstand seit dem letzten Auslesen des Encoders.">encoderGet</a>(<a class="code" href="encoder_8h.html#80fb826a684cf3f0d306b22aa100ddac">RIGHT</a>);
<a name="l00057"></a>00057         <span class="comment">// Timer0 einrichten und Überlauf Interrupt erlauben</span>
<a name="l00058"></a>00058         TCCR0 = 1&lt;&lt;CS01;                        <span class="comment">// CPU_FP divitiert durch 8 * 256 -&gt; 5,4kHz</span>
<a name="l00059"></a>00059         TIMSK |= 1&lt;&lt;TOIE0;              <span class="comment">// enable timer interrupt</span>
<a name="l00060"></a>00060 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="1ef2ce91101e182f4ce4142b56b59cb9"></a><!-- doxytag: member="encoder.h::encoderGet" ref="1ef2ce91101e182f4ce4142b56b59cb9" args="(uint8_t motor)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int16_t encoderGet           </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>motor</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Liefert den Zählerstand seit dem letzten Auslesen des Encoders. 
<p>
Der Zählerstand wird nach dem Auslesen wieder gelöscht. Dieser Programmteil ist atomar( nicht unterbrechbar) da auch die Interruptrotiene auf die Variable zugreift.<p>
<dl compact><dt><b>Parameter:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>motor</em>&nbsp;</td><td>Motor auswahl: LEFT, RIGHT</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>RÃ¼ckgabe:</b></dt><dd>Zählerdifferenz seit dem letzten Auslesen </dd></dl>

<p>
Definiert in Zeile <a class="el" href="encoder_8c-source.html#l00078">78</a> der Datei <a class="el" href="encoder_8c-source.html">encoder.c</a>.<div class="fragment"><pre class="fragment"><a name="l00079"></a>00079 {
<a name="l00080"></a>00080         int16_t r;                                                      <span class="comment">// rückgabewert</span>
<a name="l00081"></a>00081         uint8_t tmp_sreg;                               <span class="comment">// temporaerer Speicher fuer das Statusregister</span>
<a name="l00082"></a>00082         
<a name="l00083"></a>00083         tmp_sreg = SREG;                                <span class="comment">// Statusregister (also auch das I-Flag darin) sichern</span>
<a name="l00084"></a>00084         cli();                                                                  <span class="comment">// Interrupts global deaktivieren</span>
<a name="l00085"></a>00085         r = <a class="code" href="encoder_8c.html#1b398d40d387876be5f4eed816ae864e">enc_delta</a>[motor];           <span class="comment">// Encoderwert speichern</span>
<a name="l00086"></a>00086         <a class="code" href="encoder_8c.html#1b398d40d387876be5f4eed816ae864e">enc_delta</a>[motor]        = 0;    <span class="comment">// enc_delta zurücksetzen</span>
<a name="l00087"></a>00087         SREG = tmp_sreg;                                <span class="comment">// Status-Register wieder herstellen </span>
<a name="l00088"></a>00088         
<a name="l00089"></a>00089         <span class="keywordflow">return</span> r;                                                       <span class="comment">// Encoderwert zurückgeben</span>
<a name="l00090"></a>00090 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="e084907e786b88426e7ef87b1a935bda"></a><!-- doxytag: member="encoder.h::encoderToMM" ref="e084907e786b88426e7ef87b1a935bda" args="(int32_t encoder)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t encoderToMM           </td>
          <td>(</td>
          <td class="paramtype">int32_t&nbsp;</td>
          <td class="paramname"> <em>encoder</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Umrechner von EncoderFlanken nach mm. 
<p>
<dl compact><dt><b>Parameter:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>encoder</em>&nbsp;</td><td>Wert der Umgerechnet werden soll</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>RÃ¼ckgabe:</b></dt><dd>Liefert die gefahrene strecke in mm zurück </dd></dl>

<p>
Definiert in Zeile <a class="el" href="encoder_8c-source.html#l00103">103</a> der Datei <a class="el" href="encoder_8c-source.html">encoder.c</a>.<div class="fragment"><pre class="fragment"><a name="l00104"></a>00104 {
<a name="l00105"></a>00105         <span class="keywordflow">return</span> ((int32_t)(<a class="code" href="globals_8c.html#8d98bfd378d27bc50413c83662cdc0b9" title="Odometriesensor Zaehler bei Interrupt Betrieb.  encoder[0] links, encoder[1] = rechts...">encoder</a>*1000L)/<a class="code" href="encoder_8h.html#641ad630e162ad78992d76dfae66a485" title="Umrechnungsfaktor von Flanken -&gt; mm.">UMRECHNUG_ECNODER_MM</a>);
<a name="l00106"></a>00106 }
</pre></div>
<p>

</div>
</div><p>
<hr size="1"><address style="text-align: right;"><small>Erzeugt am Sun Apr 8 18:04:15 2007 fÃ¼r nBot von&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>
