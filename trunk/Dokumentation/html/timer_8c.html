<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>nBot: timer.c-Dateireferenz</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Erzeugt von Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Hauptseite</span></a></li>
    <li><a href="annotated.html"><span>Datenstrukturen</span></a></li>
    <li class="current"><a href="files.html"><span>Dateien</span></a></li>
    <li><a href="dirs.html"><span>Verzeichnisse</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>Auflistung&nbsp;der&nbsp;Dateien</span></a></li>
    <li><a href="globals.html"><span>Datei-Elemente</span></a></li>
  </ul>
</div>
<div class="nav">
<a class="el" href="dir_6bb2651bc0a152aa2f3f5a312f6d27ea.html">nbot_lib</a></div>
<h1>timer.c-Dateireferenz</h1>Zeit-, Delay- und Entprell Funktionen. <a href="#_details">Mehr ...</a>
<p>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;avr/io.h&gt;</code><br>
<code>#include &lt;avr/interrupt.h&gt;</code><br>
<code>#include &quot;<a class="el" href="timer_8h-source.html">timer.h</a>&quot;</code><br>

<p>
Include-AbhÃ¤ngigkeitsdiagramm fÃ¼r timer.c:<p><center><img src="timer_8c__incl.png" border="0" usemap="#timer.c_map" alt=""></center>
<map name="timer.c_map">
<area shape="rect" title="Zeit&#45;, Delay&#45; und Entprell Funktionen." alt="" coords="139,5,203,32"><area shape="rect" title="Zeit&#45;, Delay&#45; und Entprell Funktionen." alt="" coords="137,56,204,83"><area shape="rect" title="Zeit&#45;, Delay&#45; und Entprell Funktionen." alt="" coords="119,107,223,133"><area shape="rect" href="timer_8h.html" title="Zeit&#45;, Delay&#45; und Entprell Funktionen." alt="" coords="139,157,203,184"></map>

<p>
<a href="timer_8c-source.html">gehe zum Quellcode dieser Datei</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Funktionen</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="timer_8c.html#0eb48b6146b62e0e20d87fe066fe9f30">timer2_init</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialiseiert Timer2.  <a href="#0eb48b6146b62e0e20d87fe066fe9f30"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="timer_8c.html#68ae1ca3314f529719933f506ebdd49d">Gettime</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Gibt die aktuelle Zeit in ms zurueck.  <a href="#68ae1ca3314f529719933f506ebdd49d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="timer_8c.html#6a11f6114c1855c214665cac99c77743">sleep</a> (unsigned char time36kHz)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Wartefunktion.  <a href="#6a11f6114c1855c214665cac99c77743"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="timer_8c.html#9bfa3ac6e76567d16f6a10a5d8cd15eb">msleep</a> (int dauer)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Wartefunktion in ms.  <a href="#9bfa3ac6e76567d16f6a10a5d8cd15eb"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="timer_8c.html#7cfcbe42bd266750aeb6e5d71e5ea479">ISR</a> (TIMER2_OVF_vect)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Interrupt-Funktion fuer Timer-2-Ueberlauf.  <a href="#7cfcbe42bd266750aeb6e5d71e5ea479"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>AusfÃ¼hrliche Beschreibung</h2>
Zeit-, Delay- und Entprell Funktionen. 
<p>
Erzeugt Zeiteinheiten anhand des laufenden Timer2-Interrupts.<br>
 Dieser ist auf 36kHz eingestellt. <br>
 Die globalen Variablen <b>count36kHz</b> und <b>timebase</b> werden hier bearbeitet.<br>
 In den hier vorhandenen Funktionen werden diese Variablen genutzt<br>
 um Zeiten und Verzoegerungen zu erzeugen. Für die Entprellung ist die <a class="el" href="taste_8c.html" title="Bis zu 8 Tasten entprellen, mit gedrückt halten und wiederholungs Funktion.">taste.c</a> notwendig<p>
<dl class="see" compact><dt><b>Siehe auch:</b></dt><dd><a class="el" href="taste_8c.html" title="Bis zu 8 Tasten entprellen, mit gedrückt halten und wiederholungs Funktion.">taste.c</a></dd></dl>
<dl class="version" compact><dt><b>Version:</b></dt><dd>V001 - 25.02.2007 - Olaf Petersen<br>
 first build<br>
 </dd></dl>

<p>
Definiert in Datei <a class="el" href="timer_8c-source.html">timer.c</a>.<hr><h2>Dokumentation der Funktionen</h2>
<a class="anchor" name="68ae1ca3314f529719933f506ebdd49d"></a><!-- doxytag: member="timer.c::Gettime" ref="68ae1ca3314f529719933f506ebdd49d" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long Gettime           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Gibt die aktuelle Zeit in ms zurueck. 
<p>
Die vergangene Zeit seit dem Einschalten<br>
 Genauer: nachdem der Interrupt Timer2 aktiviert wurde.<br>
<p>
<dl compact><dt><b>Parameter:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>keine</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>RÃ¼ckgabe:</b></dt><dd>Einschaltzeit in Millisekunden (Bereich: unsigned long 0..286331153)<br>
 Das sind ca. 79.5 Stunden. Diese Zeitangabe reicht bis der Accu leer ist.</dd></dl>
<dl class="user" compact><dt><b>Beispiel:</b></dt><dd>(Nur zur Demonstration der Parameter/Returnwerte) <div class="fragment"><pre class="fragment">  <span class="comment">// Alle 500 ms die Front-LED umschalten.</span>
  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> zeit;
  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> on_off = TRUE;

  zeit = <a class="code" href="timer_8c.html#68ae1ca3314f529719933f506ebdd49d" title="Gibt die aktuelle Zeit in ms zurueck.">Gettime</a> ();
  <span class="keywordflow">while</span> (1)
  {
    <span class="keywordflow">if</span> (<a class="code" href="timer_8c.html#68ae1ca3314f529719933f506ebdd49d" title="Gibt die aktuelle Zeit in ms zurueck.">Gettime</a> () &gt; zeit + 500)
    {
      zeit = <a class="code" href="timer_8c.html#68ae1ca3314f529719933f506ebdd49d" title="Gibt die aktuelle Zeit in ms zurueck.">Gettime</a> ();
      FrontLED (on_off);
      on_off ^= 1;
    }
  }
</pre></div> </dd></dl>

<p>
Definiert in Zeile <a class="el" href="timer_8c-source.html#l00085">85</a> der Datei <a class="el" href="timer_8c-source.html">timer.c</a>.<div class="fragment"><pre class="fragment"><a name="l00086"></a>00086 {
<a name="l00087"></a>00087   <span class="keywordflow">return</span> ((<a class="code" href="globals_8c.html#8f07cc475f4e813c344e44a6efce8bc2" title="Sytemzeit in ms.">timebase</a> * 256) + <a class="code" href="globals_8c.html#61610ea211b4bea5cc5ce6136c3fa4f8" title="Counter fuer 36kHz.">count36kHz</a>) / 36;
<a name="l00088"></a>00088 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="7cfcbe42bd266750aeb6e5d71e5ea479"></a><!-- doxytag: member="timer.c::ISR" ref="7cfcbe42bd266750aeb6e5d71e5ea479" args="(TIMER2_OVF_vect)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ISR           </td>
          <td>(</td>
          <td class="paramtype">TIMER2_OVF_vect&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Interrupt-Funktion fuer Timer-2-Ueberlauf. 
<p>
<dl compact><dt><b>Parameter:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>keine</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>RÃ¼ckgabe:</b></dt><dd>nichts</dd></dl>
<dl class="see" compact><dt><b>Siehe auch:</b></dt><dd><a class="el" href="timer_8h.html#61610ea211b4bea5cc5ce6136c3fa4f8">count36kHz</a>, <a class="el" href="timer_8h.html#8f07cc475f4e813c344e44a6efce8bc2">timebase</a></dd></dl>
<dl class="user" compact><dt><b></b></dt><dd>Der zum Timer gehoerende Zaehler TCNT2 wird so justiert, dass damit die<br>
 gewuenschten 36 kHz erreicht werden.<br>
 Fuer die Zeitfunktionen werden die globalen Variablen count36kHz und<br>
 timebase hochgezaehlt. </dd></dl>

<p>
Definiert in Zeile <a class="el" href="timer_8c-source.html#l00175">175</a> der Datei <a class="el" href="timer_8c-source.html">timer.c</a>.<div class="fragment"><pre class="fragment"><a name="l00175"></a>00175                                 : SIGNAL(SIG_OVERFLOW1) */
<a name="l00176"></a>00176 {
<a name="l00177"></a>00177     <span class="comment">/* erhöht den Wert des Timers um Ihn alle 36kHz überlaufen zu lassen */</span>
<a name="l00178"></a>00178         TCNT2 += 0xD7;
<a name="l00179"></a>00179         
<a name="l00180"></a>00180         <span class="comment">/* Globalen counter erhöhen */</span>
<a name="l00181"></a>00181         <a class="code" href="globals_8c.html#61610ea211b4bea5cc5ce6136c3fa4f8" title="Counter fuer 36kHz.">count36kHz</a>++;
<a name="l00182"></a>00182         
<a name="l00183"></a>00183         <span class="comment">/* beim Überlauf globale Zeit erhöhen */</span>
<a name="l00184"></a>00184         <span class="keywordflow">if</span>(!<a class="code" href="globals_8c.html#61610ea211b4bea5cc5ce6136c3fa4f8" title="Counter fuer 36kHz.">count36kHz</a>){
<a name="l00185"></a>00185                 <a class="code" href="globals_8c.html#8f07cc475f4e813c344e44a6efce8bc2" title="Sytemzeit in ms.">timebase</a>++;
<a name="l00186"></a>00186         }
<a name="l00187"></a>00187 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="9bfa3ac6e76567d16f6a10a5d8cd15eb"></a><!-- doxytag: member="timer.c::msleep" ref="9bfa3ac6e76567d16f6a10a5d8cd15eb" args="(int dauer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void msleep           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>dauer</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Wartefunktion in ms. 
<p>
Diese Funktion nutzt die Sleep()-Funktion um mit dem uebergeben Parameter<br>
 Pausen in ms-Einheiten zu erhalten.<p>
<dl compact><dt><b>Parameter:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dauer</em>&nbsp;</td><td>Wartezeit in Millisekunden.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>RÃ¼ckgabe:</b></dt><dd>nichts</dd></dl>
<dl class="user" compact><dt><b>Beispiel:</b></dt><dd>(Nur zur Demonstration der Parameter/Returnwerte) <div class="fragment"><pre class="fragment">  <span class="comment">// 1.5 Sekunde warten</span>
  Msleep (1500);
</pre></div> </dd></dl>

<p>
Definiert in Zeile <a class="el" href="timer_8c-source.html#l00148">148</a> der Datei <a class="el" href="timer_8c-source.html">timer.c</a>.<div class="fragment"><pre class="fragment"><a name="l00149"></a>00149 {
<a name="l00150"></a>00150   <span class="keywordtype">int</span> z;
<a name="l00151"></a>00151   <span class="keywordflow">for</span> (z = 0; z &lt; dauer; z++)   <span class="comment">// z-mal ..</span>
<a name="l00152"></a>00152     <a class="code" href="timer_8c.html#6a11f6114c1855c214665cac99c77743" title="Wartefunktion.">sleep</a> (36);                                 <span class="comment">// ..eine ms warten</span>
<a name="l00153"></a>00153 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="6a11f6114c1855c214665cac99c77743"></a><!-- doxytag: member="timer.c::sleep" ref="6a11f6114c1855c214665cac99c77743" args="(unsigned char time36kHz)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sleep           </td>
          <td>(</td>
          <td class="paramtype">unsigned char&nbsp;</td>
          <td class="paramname"> <em>time36kHz</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Wartefunktion. 
<p>
Die maximale Wartezeit betraegt 7ms. Fuer laengere Wartezeiten siehe Msleep().<br>
 Diese Funktion nutzt den Timer 2-Interrupt um ein 'zeitgefuehl' zu erhalten.<br>
 Der Interrupt wird mit 36 kHz, durch die Init()-Funktion initialisiert,<br>
 aufgerufen und zaehlt dort die globale Variablen <b>count36kHz</b> weiter.<br>
 Diese Funktion nutzt diesen Zaehler und berechnet daraus mit dem uebergeben<br>
 Parameter den Zeitpunkt wann die Pausenzeit erreicht ist, Danach bricht sie<br>
 ab, und im Hauptprogramm ist eben eine Wartezeit eingelegt worden.<p>
<dl compact><dt><b>Parameter:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>time36kHz</em>&nbsp;</td><td>Wartezeit x/36kHz (sec)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>RÃ¼ckgabe:</b></dt><dd>nichts</dd></dl>
<dl class="user" compact><dt><b>Beispiel:</b></dt><dd>(Nur zur Demonstration der Parameter/Returnwerte) <div class="fragment"><pre class="fragment">  <span class="comment">// 1 Millisekunde warten</span>
  Sleep (36);
</pre></div> </dd></dl>

<p>
Definiert in Zeile <a class="el" href="timer_8c-source.html#l00116">116</a> der Datei <a class="el" href="timer_8c-source.html">timer.c</a>.<div class="fragment"><pre class="fragment"><a name="l00118"></a>00118 {
<a name="l00119"></a>00119   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ziel = (time36kHz + <a class="code" href="globals_8c.html#61610ea211b4bea5cc5ce6136c3fa4f8" title="Counter fuer 36kHz.">count36kHz</a>) &amp; 0x00FF;
<a name="l00120"></a>00120 
<a name="l00121"></a>00121   <span class="keywordflow">while</span> (<a class="code" href="globals_8c.html#61610ea211b4bea5cc5ce6136c3fa4f8" title="Counter fuer 36kHz.">count36kHz</a> != ziel)
<a name="l00122"></a>00122     ;
<a name="l00123"></a>00123 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="0eb48b6146b62e0e20d87fe066fe9f30"></a><!-- doxytag: member="timer.c::timer2_init" ref="0eb48b6146b62e0e20d87fe066fe9f30" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void timer2_init           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initialiseiert Timer2. 
<p>
Timer2 löst alle 36kHz ein interrupt aus und fürt alle 250Hz eine Tastenentprellung durch<p>
<dl compact><dt><b>Parameter:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>keine</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>RÃ¼ckgabe:</b></dt><dd>nichts </dd></dl>

<p>
Definiert in Zeile <a class="el" href="timer_8c-source.html#l00042">42</a> der Datei <a class="el" href="timer_8c-source.html">timer.c</a>.<div class="fragment"><pre class="fragment"><a name="l00043"></a>00043 {
<a name="l00044"></a>00044         <span class="comment">/* Timer2 auf 36 kHz eingestellt. */</span>
<a name="l00045"></a>00045         TCCR2 = (1 &lt;&lt; WGM20) | (1 &lt;&lt; WGM21) | (1 &lt;&lt; COM20) | (1 &lt;&lt; COM21) | (1 &lt;&lt; CS21);
<a name="l00046"></a>00046 
<a name="l00047"></a>00047         <span class="comment">/* Interrupts für Timer2 aktivieren */</span>  
<a name="l00048"></a>00048         TIMSK |= (1&lt;&lt;TOIE2);
<a name="l00049"></a>00049 }       
</pre></div>
<p>

</div>
</div><p>
<hr size="1"><address style="text-align: right;"><small>Erzeugt am Sun Apr 8 18:04:16 2007 fÃ¼r nBot von&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>
